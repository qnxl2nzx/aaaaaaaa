local Vortex = {}
Vortex.__index = Vortex

local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

-- Utils
local function tween(obj, props, duration)
	local info = TweenInfo.new(duration or 0.3, Enum.EasingStyle.Quint, Enum.EasingDirection.Out)
	TweenService:Create(obj, info, props):Play()
end

local function ripple(btn, x, y)
	local circle = Instance.new("ImageLabel")
	circle.Name = "Ripple"
	circle.Parent = btn
	circle.BackgroundTransparency = 1
	circle.Image = "rbxasset://textures/ui/GuiImagePlaceholder.png"
	circle.ImageColor3 = Color3.fromRGB(255, 255, 255)
	circle.ImageTransparency = 0.8
	circle.ZIndex = btn.ZIndex + 1
	circle.Position = UDim2.new(0, x, 0, y)
	circle.Size = UDim2.new(0, 0, 0, 0)
	circle.AnchorPoint = Vector2.new(0.5, 0.5)
	
	local size = math.max(btn.AbsoluteSize.X, btn.AbsoluteSize.Y) * 2
	tween(circle, {Size = UDim2.new(0, size, 0, size), ImageTransparency = 1}, 0.5)
	game:GetService("Debris"):AddItem(circle, 0.5)
end

-- Main Library
function Vortex:CreateWindow(config)
	config = config or {}
	local windowName = config.Name or "Vortex UI"
	local windowSize = config.Size or UDim2.new(0, 550, 0, 400)
	
	-- ScreenGui
	local gui = Instance.new("ScreenGui")
	gui.Name = "VortexUI_" .. windowName
	gui.ResetOnSpawn = false
	gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
	gui.Parent = CoreGui
	
	-- Main Frame
	local main = Instance.new("Frame")
	main.Name = "Main"
	main.Size = windowSize
	main.Position = UDim2.new(0.5, 0, 0.5, 0)
	main.AnchorPoint = Vector2.new(0.5, 0.5)
	main.BackgroundColor3 = Color3.fromRGB(20, 20, 25)
	main.BorderSizePixel = 0
	main.ClipsDescendants = true
	main.Parent = gui
	
	local mainCorner = Instance.new("UICorner")
	mainCorner.CornerRadius = UDim.new(0, 10)
	mainCorner.Parent = main
	
	-- Glow Shadow
	local shadow = Instance.new("ImageLabel")
	shadow.Name = "Shadow"
	shadow.Size = UDim2.new(1, 40, 1, 40)
	shadow.Position = UDim2.new(0.5, 0, 0.5, 0)
	shadow.AnchorPoint = Vector2.new(0.5, 0.5)
	shadow.BackgroundTransparency = 1
	shadow.Image = "rbxassetid://5554236805"
	shadow.ImageColor3 = Color3.fromRGB(100, 60, 200)
	shadow.ImageTransparency = 0.7
	shadow.ZIndex = -1
	shadow.Parent = main
	
	-- Top Bar
	local topbar = Instance.new("Frame")
	topbar.Name = "TopBar"
	topbar.Size = UDim2.new(1, 0, 0, 45)
	topbar.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
	topbar.BorderSizePixel = 0
	topbar.Parent = main
	
	local topCorner = Instance.new("UICorner")
	topCorner.CornerRadius = UDim.new(0, 10)
	topCorner.Parent = topbar
	
	local topbarFix = Instance.new("Frame")
	topbarFix.Size = UDim2.new(1, 0, 0, 10)
	topbarFix.Position = UDim2.new(0, 0, 1, -10)
	topbarFix.BackgroundColor3 = Color3.fromRGB(25, 25, 32)
	topbarFix.BorderSizePixel = 0
	topbarFix.Parent = topbar
	
	-- Title
	local title = Instance.new("TextLabel")
	title.Name = "Title"
	title.Size = UDim2.new(1, -50, 1, 0)
	title.Position = UDim2.new(0, 15, 0, 0)
	title.BackgroundTransparency = 1
	title.Text = windowName
	title.TextColor3 = Color3.fromRGB(255, 255, 255)
	title.TextSize = 18
	title.Font = Enum.Font.GothamBold
	title.TextXAlignment = Enum.TextXAlignment.Left
	title.Parent = topbar
	
	-- Close Button
	local closeBtn = Instance.new("TextButton")
	closeBtn.Name = "CloseBtn"
	closeBtn.Size = UDim2.new(0, 35, 0, 35)
	closeBtn.Position = UDim2.new(1, -40, 0.5, 0)
	closeBtn.AnchorPoint = Vector2.new(0, 0.5)
	closeBtn.BackgroundColor3 = Color3.fromRGB(35, 35, 42)
	closeBtn.BorderSizePixel = 0
	closeBtn.Text = "Ã—"
	closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
	closeBtn.TextSize = 24
	closeBtn.Font = Enum.Font.GothamBold
	closeBtn.Parent = topbar
	
	local closeBtnCorner = Instance.new("UICorner")
	closeBtnCorner.CornerRadius = UDim.new(0, 8)
	closeBtnCorner.Parent = closeBtn
	
	closeBtn.MouseButton1Click:Connect(function()
		tween(main, {Size = UDim2.new(0, 0, 0, 0)}, 0.3)
		wait(0.3)
		gui:Destroy()
	end)
	
	closeBtn.MouseEnter:Connect(function()
		tween(closeBtn, {BackgroundColor3 = Color3.fromRGB(200, 50, 50)}, 0.2)
	end)
	
	closeBtn.MouseLeave:Connect(function()
		tween(closeBtn, {BackgroundColor3 = Color3.fromRGB(35, 35, 42)}, 0.2)
	end)
	
	-- Dragging
	local dragging, dragInput, dragStart, startPos
	
	topbar.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 then
			dragging = true
			dragStart = input.Position
			startPos = main.Position
			
			input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					dragging = false
				end
			end)
		end
	end)
	
	topbar.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement then
			dragInput = input
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if input == dragInput and dragging then
			local delta = input.Position - dragStart
			main.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
		end
	end)
	
	-- Tab System
	local tabContainer = Instance.new("Frame")
	tabContainer.Name = "TabContainer"
	tabContainer.Size = UDim2.new(0, 140, 1, -55)
	tabContainer.Position = UDim2.new(0, 10, 0, 50)
	tabContainer.BackgroundTransparency = 1
	tabContainer.Parent = main
	
	local tabList = Instance.new("UIListLayout")
	tabList.SortOrder = Enum.SortOrder.LayoutOrder
	tabList.Padding = UDim.new(0, 5)
	tabList.Parent = tabContainer
	
	-- Content Container
	local contentContainer = Instance.new("Frame")
	contentContainer.Name = "ContentContainer"
	contentContainer.Size = UDim2.new(1, -165, 1, -65)
	contentContainer.Position = UDim2.new(0, 155, 0, 55)
	contentContainer.BackgroundTransparency = 1
	contentContainer.Parent = main
	
	-- Window Object
	local Window = {
		GUI = gui,
		Main = main,
		Tabs = {},
		CurrentTab = nil
	}
	
	function Window:CreateTab(tabName)
		local Tab = {}
		
		-- Tab Button
		local tabBtn = Instance.new("TextButton")
		tabBtn.Name = tabName
		tabBtn.Size = UDim2.new(1, 0, 0, 38)
		tabBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 38)
		tabBtn.BorderSizePixel = 0
		tabBtn.Text = tabName
		tabBtn.TextColor3 = Color3.fromRGB(180, 180, 180)
		tabBtn.TextSize = 14
		tabBtn.Font = Enum.Font.Gotham
		tabBtn.ClipsDescendants = true
		tabBtn.Parent = tabContainer
		
		local tabBtnCorner = Instance.new("UICorner")
		tabBtnCorner.CornerRadius = UDim.new(0, 8)
		tabBtnCorner.Parent = tabBtn
		
		-- Tab Content
		local tabContent = Instance.new("ScrollingFrame")
		tabContent.Name = tabName .. "_Content"
		tabContent.Size = UDim2.new(1, 0, 1, 0)
		tabContent.BackgroundTransparency = 1
		tabContent.BorderSizePixel = 0
		tabContent.ScrollBarThickness = 4
		tabContent.ScrollBarImageColor3 = Color3.fromRGB(100, 60, 200)
		tabContent.CanvasSize = UDim2.new(0, 0, 0, 0)
		tabContent.Visible = false
		tabContent.Parent = contentContainer
		
		local contentList = Instance.new("UIListLayout")
		contentList.SortOrder = Enum.SortOrder.LayoutOrder
		contentList.Padding = UDim.new(0, 8)
		contentList.Parent = tabContent
		
		contentList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			tabContent.CanvasSize = UDim2.new(0, 0, 0, contentList.AbsoluteContentSize.Y + 10)
		end)
		
		Tab.Content = tabContent
		Tab.Button = tabBtn
		
		tabBtn.MouseButton1Click:Connect(function()
			ripple(tabBtn, tabBtn.AbsoluteSize.X/2, tabBtn.AbsoluteSize.Y/2)
			
			for _, tab in pairs(Window.Tabs) do
				tab.Content.Visible = false
				tween(tab.Button, {BackgroundColor3 = Color3.fromRGB(30, 30, 38), TextColor3 = Color3.fromRGB(180, 180, 180)}, 0.2)
			end
			
			tabContent.Visible = true
			tween(tabBtn, {BackgroundColor3 = Color3.fromRGB(100, 60, 200), TextColor3 = Color3.fromRGB(255, 255, 255)}, 0.2)
			Window.CurrentTab = Tab
		end)
		
		-- Auto-select first tab
		if #Window.Tabs == 0 then
			tabBtn.MouseButton1Click:Fire()
		end
		
		table.insert(Window.Tabs, Tab)
		
		-- Tab Functions
		function Tab:CreateButton(config)
			config = config or {}
			local btnText = config.Text or "Button"
			local callback = config.Callback or function() end
			
			local btn = Instance.new("TextButton")
			btn.Name = "Button"
			btn.Size = UDim2.new(1, -10, 0, 40)
			btn.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
			btn.BorderSizePixel = 0
			btn.Text = btnText
			btn.TextColor3 = Color3.fromRGB(255, 255, 255)
			btn.TextSize = 14
			btn.Font = Enum.Font.Gotham
			btn.ClipsDescendants = true
			btn.Parent = tabContent
			
			local btnCorner = Instance.new("UICorner")
			btnCorner.CornerRadius = UDim.new(0, 8)
			btnCorner.Parent = btn
			
			btn.MouseButton1Click:Connect(function()
				ripple(btn, btn.AbsoluteSize.X/2, btn.AbsoluteSize.Y/2)
				callback()
			end)
			
			btn.MouseEnter:Connect(function()
				tween(btn, {BackgroundColor3 = Color3.fromRGB(45, 45, 55)}, 0.2)
			end)
			
			btn.MouseLeave:Connect(function()
				tween(btn, {BackgroundColor3 = Color3.fromRGB(35, 35, 45)}, 0.2)
			end)
		end
		
		function Tab:CreateToggle(config)
			config = config or {}
			local toggleText = config.Text or "Toggle"
			local defaultState = config.Default or false
			local callback = config.Callback or function() end
			
			local toggleFrame = Instance.new("Frame")
			toggleFrame.Name = "Toggle"
			toggleFrame.Size = UDim2.new(1, -10, 0, 40)
			toggleFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
			toggleFrame.BorderSizePixel = 0
			toggleFrame.Parent = tabContent
			
			local toggleCorner = Instance.new("UICorner")
			toggleCorner.CornerRadius = UDim.new(0, 8)
			toggleCorner.Parent = toggleFrame
			
			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(1, -50, 1, 0)
			label.Position = UDim2.new(0, 10, 0, 0)
			label.BackgroundTransparency = 1
			label.Text = toggleText
			label.TextColor3 = Color3.fromRGB(255, 255, 255)
			label.TextSize = 14
			label.Font = Enum.Font.Gotham
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = toggleFrame
			
			local toggleBtn = Instance.new("TextButton")
			toggleBtn.Size = UDim2.new(0, 40, 0, 20)
			toggleBtn.Position = UDim2.new(1, -45, 0.5, 0)
			toggleBtn.AnchorPoint = Vector2.new(0, 0.5)
			toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
			toggleBtn.BorderSizePixel = 0
			toggleBtn.Text = ""
			toggleBtn.Parent = toggleFrame
			
			local toggleBtnCorner = Instance.new("UICorner")
			toggleBtnCorner.CornerRadius = UDim.new(1, 0)
			toggleBtnCorner.Parent = toggleBtn
			
			local circle = Instance.new("Frame")
			circle.Size = UDim2.new(0, 16, 0, 16)
			circle.Position = UDim2.new(0, 2, 0.5, 0)
			circle.AnchorPoint = Vector2.new(0, 0.5)
			circle.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
			circle.BorderSizePixel = 0
			circle.Parent = toggleBtn
			
			local circleCorner = Instance.new("UICorner")
			circleCorner.CornerRadius = UDim.new(1, 0)
			circleCorner.Parent = circle
			
			local toggled = defaultState
			
			local function updateToggle()
				if toggled then
					tween(toggleBtn, {BackgroundColor3 = Color3.fromRGB(100, 60, 200)}, 0.2)
					tween(circle, {Position = UDim2.new(1, -2, 0.5, 0)}, 0.2)
				else
					tween(toggleBtn, {BackgroundColor3 = Color3.fromRGB(50, 50, 60)}, 0.2)
					tween(circle, {Position = UDim2.new(0, 2, 0.5, 0)}, 0.2)
				end
				callback(toggled)
			end
			
			updateToggle()
			
			toggleBtn.MouseButton1Click:Connect(function()
				toggled = not toggled
				updateToggle()
			end)
		end
		
		function Tab:CreateSlider(config)
			config = config or {}
			local sliderText = config.Text or "Slider"
			local min = config.Min or 0
			local max = config.Max or 100
			local default = config.Default or 50
			local callback = config.Callback or function() end
			
			local sliderFrame = Instance.new("Frame")
			sliderFrame.Name = "Slider"
			sliderFrame.Size = UDim2.new(1, -10, 0, 50)
			sliderFrame.BackgroundColor3 = Color3.fromRGB(35, 35, 45)
			sliderFrame.BorderSizePixel = 0
			sliderFrame.Parent = tabContent
			
			local sliderCorner = Instance.new("UICorner")
			sliderCorner.CornerRadius = UDim.new(0, 8)
			sliderCorner.Parent = sliderFrame
			
			local label = Instance.new("TextLabel")
			label.Size = UDim2.new(0.7, 0, 0, 20)
			label.Position = UDim2.new(0, 10, 0, 5)
			label.BackgroundTransparency = 1
			label.Text = sliderText
			label.TextColor3 = Color3.fromRGB(255, 255, 255)
			label.TextSize = 14
			label.Font = Enum.Font.Gotham
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.Parent = sliderFrame
			
			local valueLabel = Instance.new("TextLabel")
			valueLabel.Size = UDim2.new(0.3, -10, 0, 20)
			valueLabel.Position = UDim2.new(0.7, 0, 0, 5)
			valueLabel.BackgroundTransparency = 1
			valueLabel.Text = tostring(default)
			valueLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
			valueLabel.TextSize = 14
			valueLabel.Font = Enum.Font.Gotham
			valueLabel.TextXAlignment = Enum.TextXAlignment.Right
			valueLabel.Parent = sliderFrame
			
			local sliderBack = Instance.new("Frame")
			sliderBack.Size = UDim2.new(1, -20, 0, 6)
			sliderBack.Position = UDim2.new(0, 10, 1, -15)
			sliderBack.BackgroundColor3 = Color3.fromRGB(50, 50, 60)
			sliderBack.BorderSizePixel = 0
			sliderBack.Parent = sliderFrame
			
			local sliderBackCorner = Instance.new("UICorner")
			sliderBackCorner.CornerRadius = UDim.new(1, 0)
			sliderBackCorner.Parent = sliderBack
			
			local sliderFill = Instance.new("Frame")
			sliderFill.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
			sliderFill.BackgroundColor3 = Color3.fromRGB(100, 60, 200)
			sliderFill.BorderSizePixel = 0
			sliderFill.Parent = sliderBack
			
			local sliderFillCorner = Instance.new("UICorner")
			sliderFillCorner.CornerRadius = UDim.new(1, 0)
			sliderFillCorner.Parent = sliderFill
			
			local draggingSlider = false
			
			sliderBack.InputBegan:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 then
					draggingSlider = true
				end
			end)
			
			UserInputService.InputEnded:Connect(function(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 then
					draggingSlider = false
				end
			end)
			
			UserInputService.InputChanged:Connect(function(input)
				if draggingSlider and input.UserInputType == Enum.UserInputType.MouseMovement then
					local pos = math.clamp((input.Position.X - sliderBack.AbsolutePosition.X) / sliderBack.AbsoluteSize.X, 0, 1)
					local value = math.floor(min + (max - min) * pos)
					
					sliderFill.Size = UDim2.new(pos, 0, 1, 0)
					valueLabel.Text = tostring(value)
					callback(value)
				end
			end)
		end
		
		function Tab:CreateLabel(text)
			local label = Instance.new("TextLabel")
			label.Name = "Label"
			label.Size = UDim2.new(1, -10, 0, 30)
			label.BackgroundTransparency = 1
			label.Text = text or "Label"
			label.TextColor3 = Color3.fromRGB(200, 200, 200)
			label.TextSize = 14
			label.Font = Enum.Font.Gotham
			label.TextXAlignment = Enum.TextXAlignment.Left
			label.TextWrapped = true
			label.Parent = tabContent
		end
		
		return Tab
	end
	
	-- Spawn animation
	main.Size = UDim2.new(0, 0, 0, 0)
	tween(main, {Size = windowSize}, 0.4)
	
	return Window
end

return Vortex
